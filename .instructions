# csharpDialog Development Instructions

## CRITICAL ENTERPRISE SECURITY REQUIREMENTS

### ‚ö†Ô∏è CODE SIGNING MANDATORY
- **ALL BINARIES MUST BE SIGNED** before execution in this enterprise environment
- Use `.\sign-build.ps1 -All` to build and sign everything
- Certificate: "EmilyCarrU Intune Windows Enterprise Certificate"
- Unsigned binaries will be blocked by enterprise security policies

### Build & Sign Process
```powershell
# Always use this workflow:
.\sign-build.ps1 -All    # Build and sign everything
# OR
.\sign-build.ps1 -Build  # Build only
.\sign-build.ps1 -Sign   # Sign existing binaries
```

## PROJECT STRUCTURE
```
csharpdialog/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ csharpdialog.Core/        # Shared library
‚îÇ   ‚îú‚îÄ‚îÄ csharpdialog.CLI/         # Console interface
‚îÇ   ‚îú‚îÄ‚îÄ csharpdialog.WPF/         # Windows GUI
‚îÇ   ‚îî‚îÄ‚îÄ CommandFileTest/          # Test project
‚îú‚îÄ‚îÄ .instructions                 # This file - ALWAYS REFERENCE
‚îú‚îÄ‚îÄ ENTERPRISE_INSTRUCTIONS.md    # Detailed enterprise requirements
‚îú‚îÄ‚îÄ FEATURE_PARITY_ACTION_PLAN.md # Implementation roadmap
‚îî‚îÄ‚îÄ sign-build.ps1               # Build & signing script
```

## CURRENT PROJECT STATUS

### ‚úÖ Completed Features
- Multi-project solution (.NET 9.0)
- Console and WPF dialog implementations
- Basic command-line argument parsing
- Enterprise code signing integration
- Clean production codebase
- **Phase 1: Command File Monitoring System** ‚úÖ
  - Real-time file monitoring with FileSystemWatcher
  - Command parsing (title:, message:, progress:, quit:)
  - CommandFileMonitor and CommandParser classes
  - Timeout and basic list item support

### ‚úÖ Phase 4: Advanced JSON Configuration Support - COMPLETE
**Status**: Successfully implemented advanced JSON configuration for complex dialog setups ‚úÖ

#### Implemented Features:
- JSON schema for dialog configuration ‚úÖ
- Complex button configurations with icons and actions ‚úÖ
- Advanced styling and theme support ‚úÖ
- Configuration validation and error reporting ‚úÖ
- Metadata system for extensible properties ‚úÖ
- Dynamic theme switching (light/dark/modern) ‚úÖ

### üöß IN PROGRESS: Phase 5 - Shell Command Execution Integration
**Current Focus**: Implementing shell command execution with real-time output capture

#### Next to Implement:
- Shell command execution service
- Real-time output streaming to dialog
- Command result integration with progress tracking
- Security controls for command execution
- PowerShell and CMD support

#### Commands Supported:
```
title: <text>               # Update dialog title
message: <text>             # Update dialog message  
progress: <int>             # Set progress percentage (0-100)
progresstext: <text>        # Update progress text
progressincrement: <int>    # Increment progress by value
progressreset:              # Reset progress to 0
listitem: title: <title>, status: <status>, statustext: <text>  # Update list items
config: <json>              # Load JSON configuration
style: <json>               # Apply styling configuration
theme: <theme_name>         # Switch themes
execute: <command>          # Execute shell command
executepowershell: <script> # Execute PowerShell script
executeoutput: <command>    # Execute and capture output
quit:                       # Close dialog
```

### üéØ Next Priorities (Phase 5)
- Shell command execution with output capture
- Real-time command output streaming
- Command result integration with dialog updates

## DEVELOPMENT WORKFLOW

### 1. Before Making Changes
- Always reference this `.instructions` file
- Check `FEATURE_PARITY_ACTION_PLAN.md` for context
- Ensure enterprise security compliance

### 2. After Code Changes
- Build and sign: `.\sign-build.ps1 -All`
- Test with signed binaries only
- Update documentation if needed

### 3. Testing Commands
```powershell
# Test CLI with command file
.\src\csharpDialog.CLI\bin\Debug\net9.0\csharpDialog.CLI.exe --title "Test" --commandfile "%TEMP%\test.log"

# Test WPF
.\src\csharpDialog.WPF\bin\Debug\net9.0-windows\csharpDialog.WPF.exe --title "Test"
```

## ARCHITECTURE PRINCIPLES

### Core Library (csharpdialog.Core)
- Shared models and interfaces
- Command processing logic
- Cross-platform compatibility focus

### CLI Implementation (csharpdialog.CLI)
- Console-based dialogs
- Script automation support
- Command file monitoring

### WPF Implementation (csharpdialog.WPF)
- Rich Windows GUI
- Real-time UI updates
- Enterprise styling

## CODING STANDARDS

### File Naming Convention
- Use lowercase for src folder contents: `csharpdialog.Core` not `CsharpDialog.Core`
- Follow .NET naming conventions for classes
- Maintain consistent project structure

### Security Requirements
- All file operations must be secure
- Command file monitoring with proper permissions
- Input validation for all external commands
- No shell execution without proper sandboxing

## SWIFTDIALOG COMPATIBILITY TARGET

### Command File Features (Priority 1)
- Real-time dialog updates via file monitoring
- Standard command syntax compatibility
- Default file: `/var/tmp/dialog.log` (macOS) ‚Üí `%TEMP%\csharpdialog.log` (Windows)

### List Item Status Tracking (Priority 2)
- Dynamic list updates with status icons
- Per-item progress tracking
- Command syntax: `listitem: title: <title>, status: <status>, statustext: <text>`

## COMMON ISSUES & SOLUTIONS

### "Access Denied" Errors
- Usually means binary is unsigned
- Run `.\sign-build.ps1 -Sign` to fix

### Command File Not Working
- Check file permissions
- Verify FileSystemWatcher is monitoring correct path
- Test with simple commands first (title:, quit:)

### Build Failures
- Clean solution: `dotnet clean`
- Rebuild: `.\sign-build.ps1 -All`
- Check for missing dependencies

---

**REMEMBER**: Always sign binaries before testing in this enterprise environment!
